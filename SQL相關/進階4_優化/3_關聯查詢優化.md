# 關聯查詢(多表查詢) 優化

### 概述

1. 內連接(Inner Join)

    * 內連接用於檢索兩個表中符合連接條件的匹配行。

    * 如果在其中一個表格中沒有符合的行，則該行將不會包含在結果集中。

2. 外連接(Outer Join)

    * 外連接用於檢索兩個表中符合連接條件的行，同時傳回未匹配的行。

    * 有三種類型的外連接：
    
        * 左外連接 (LEFT OUTER JOIN)
        * 右外連接 (RIGHT OUTER JOIN)
        * 全外連接 (FULL OUTER JOIN)

3. #### 驅動表與被驅動表

    ```sql
    select ...
    from A inner join B
        on A.id = B.id;
    ```

    * 上述例子，A為驅動表，B為被驅動表。 查詢時，會先遍歷A表，將`A.id = 1` 取出，再遍歷 B 表，找出符合的1筆，加到結果集中，再來是 `A.id = 2`，以此類推，故執行比對的次數是 `A行數 * B行數`。

    * 若要添加索引，應加在`被驅動表的欄位上`，即 `B.id`。
    
    * 此時執行比對的次數是`A行數 * log(B行數)`(以2為底數)，B表不進行全表掃描，直接依照索引查找 B+ Tree，若是B表要回表查詢則比對次數是`A行數 * 2log(B行數)`。


<br/>

<br/>

### 內連接規則

* 對於內連接來說，查詢優化器可以決定哪張表可以做為`驅動表`、哪張表可以作為`被驅動表`，無關SQL寫的順序。

    * 可以使用 `STRAIGHT_JOIN` 來鎖定，不讓優化器去選擇誰是驅動表，故A表就一定是驅動表，B表一定是被驅動表。

        ```sql
        select ...
        from A STRAIGHT_JOIN B
            on A.id = B.id;
        ```

* 對於內連接來說，如果表的連接條件只能有一個欄位有索引，則`有索引的表會被作為被驅動表`。

    ```sql
    -- 舉例，A、B兩表作內連接
    -- 若只有B.id有索引，B表會被作為被驅動表
    select ...
    from A inner join B
        on A.id = B.id;
    ```

* 對於內連接來說，在兩個表的連接條件都存在索引的情況，小表會作為`驅動表，大表作為被驅動表`，即`小表驅動大表`。

<br/>

<br/>

### 外連接規則
優化器無法自由的選擇誰為驅動表、被驅動表，只能由SQL書寫的順序，寫在`前面的就是驅動表`。

<br/>

<br/>