# 配置

## 核心配置 nginx.conf

通常`1個ip`可以對應`多個域名`，以達到主機資源不浪費。

故可以多個`虛擬主機(server)` 同時監聽 80, 443 port，並用域名來區分專案目錄。

注意：配置中 `listen + server_name` 必須是唯一值，重複了就無法啟動。
```config
server{

    listen          80
    server_name     demo.com.tw
}
```

配置範例：
```conf
# user
user nginx;

# 子進程的數量，通常會以cpu數量來做設定，1個cpu對應1個process
worker_processes auto;

# 日誌存放位置
error_log /var/log/nginx/error.log notice;

# 紀錄pid檔案位置
pid /run/nginx.pid;

# Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.
include /usr/share/nginx/modules/*.conf;

events {
    # 每一個 worker 進程，可以創建多少個連接
    worker_connections 1024;
}

http {
    # 一般來說，定義檔案類型由服務器端來定義的。
    # 若要傳輸檔案，都會在 http header (Content-Type)定義檔案類型。
    # 舉例，當請求一張image.png，瀏覽器會是展示圖片還是下載，瀏覽器會根據 Content-Type 來決定後續動作。
    # mime.types 檔案中，只要符合副檔名，就會自動添加相對應的 Content-Type。
    include             /etc/nginx/mime.types;
    # 呈上，若沒有指定Content-Type，就用這個類別
    default_type        application/octet-stream;

    # sendfile off：nginx讀取檔案 -> 複製檔案到記憶體 -> 發送給linux網路接口 -> 回給Client
    # sendfile on ：nginx發送信號 -> linux網路接口直接讀取檔案 -> 回給Client
    # 簡單來說就是少了一個複製的步驟
    sendfile            on;

    # Load modular configuration files from the /etc/nginx/conf.d directory.
    include /etc/nginx/conf.d/*.conf;

    # 一個 http 下，可以有多個 server 主機
    # 多個 server 可以監聽同一個 port，
    server {
        listen       80;
        server_name  domain1.com; # 配置域名
        root         /usr/share/nginx/html;

        # http://domain1.com/xxoo/index.html
        # location 指的是 uri，即 /xxoo/index.html
        # 補充：
        # URI 在某一規則下能把一個資源獨一無二標示出來
        # URL 簡單說就是詳細位址(網址)
        location / {
            root    /usr/share/nginx/html/web; # 專案目錄
            index   index.html index.htm
        }

        error_page 404 /404.html;
        location = /404.html {
        }

        error_page 500 502 503 504 /50x.html;
        location = /50x.html {
        }
    }
}
```

<br/>

<br/>

## server_name

server_name 可以配多個域名

```conf
server {
    
    listem          443;
    # 1. 可以直接寫多個 domain
    server_name     one.demo.com two.demo.com; 
    # 2. 使用萬用字元 * 
    server_name     *.demo.com;
    # 3. 使用regex，~表示正則，^$表示開頭和結束
    server_name ~^[0-9]+\.demo\.com$;
}
```

注意：如果有 server_name 匹配了就不會往下找了，例如 `dev.test.demo.com`，就只會找到第一個配置。

```conf
server {
    listem          443;
    server_name     *.demo.com;
}

server {
    listem          443;
    server_name     *.test.demo.com;
}
```
